<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>User Auth & Checklist App</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    input, button { margin: 5px; padding: 5px; }
    h2 { margin-top: 30px; }
    ul { list-style-type: none; padding: 0; }
    li { margin-bottom: 10px; }
    .checklist-item { display: flex; align-items: center; gap: 10px; }
    .initials-input { width: 50px; }
  </style>
</head>
<body>
<div class="mainTopnumber">
    
       

    <!-- top nav bar -->
    <div style="z-index: 10;" class="topnav">

        <div style="background-color: darkgrey; z-index: 10;" class="topnav1">
            <a class="aTagTopNavDivLogo" style="font-size: 22px; "
                href="https://patrolpeakplanner.github.io/PatrolPeakPlanner/home.html">
                <div style="z-index: 10; color: black; margin-left:20px;margin-top: 0px;padding-top: 25px;"
                    class="mainLogo1">

                    <h3
                        style="font-family:Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif; font-size: 36px; color: white; text-shadow: 0px 0px 10px black;">
                        PATROLPEAKPLANNER </h3>
            </a>
            <a href="https://patrolpeakplanner.github.io/PatrolPeakPlanner/home.html"><button
                    style="font-size: 12px;">LIFEGAURD</button>
            </a>
            <a href="https://patrolpeakplanner.github.io/PatrolPeakPlanner/index.html"><button
                    style="font-size: 12px;">SKI PATROL</button>
            </a>
            <!-- <a href="/Users/ptk726/Desktop/dev/PatrolPeakPlanner/index.html" ><button style="font-size: 12px;">LOGIN
                </button> -->
            </a>
            <a href="https://patrolpeakplanner.github.io/PatrolPeakPlanner/index.html"><button onclick="ShowSignUp()" style="font-size: 12px;">SIGNUP & LOGIN
                </button>
            </a>

        </div>

        <br>
    </div>
</div>
<!-- end of top nav -->
 <div
        style="background-image: url('https://github.com/PatrolPeakPlanner/PatrolPeakPlanner/blob/main/ImagePool.jpg?raw=true'); height: auto; background-repeat: no-repeat; background-size: cover; text-align: left; padding: 0 50px; font-size: 20px; font-family: arial; color: white; text-shadow: 0px 0px 3px black">
        <br>


  <!-- <h1>User Authentication & Checklist App</h1> -->
<div id="SignUpID" style="display: none;" >
  <!-- Sign Up Section -->
  <h2>Sign Up</h2>
  <input type="text" id="signupName" placeholder="Name">
  <input type="email" id="signupEmail" placeholder="Email">
  <input type="password" id="signupPassword" placeholder="Password"><br>
  <input type="text" id="securityQuestion1" placeholder="Security Question 1">
  <input type="text" id="securityAnswer1" placeholder="Answer 1"><br>
  <input type="text" id="securityQuestion2" placeholder="Security Question 2">
  <input type="text" id="securityAnswer2" placeholder="Answer 2"><br>
  <button onclick="signUp()">Sign Up</button>


  <!-- Login Section -->
  <h2>Login</h2>
  <input type="email" id="loginEmail" placeholder="Email">
  <input type="password" id="loginPassword" placeholder="Password"><br>
  <button onclick="login(); LoggedInOpenChecklist(); CloseSignUp();">Login</button>

  <!-- Forgot Password Section -->
  <h2>Forgot Password</h2>
  <input type="email" id="forgotEmail" placeholder="Email"><br>
  <button onclick="getSecurityQuestions()">Get Security Questions</button><br>
  <div id="securityQuestionsSection" style="display:none;">
    <p id="securityQ1"></p>
    <input type="text" id="answer1" placeholder="Answer 1"><br>
    <p id="securityQ2"></p>
    <input type="text" id="answer2" placeholder="Answer 2"><br>
    <input type="password" id="newPassword" placeholder="New Password"><br>
    <button onclick="verifySecurityAnswers()">Reset Password</button>
  </div>

</div>
<!-- end of sign up login section -->


<br>
  <!-- Checklist Section -->
<div id="checklistID" style="display: none; background-color: white; color: black; text-shadow:none; border-radius: 20px; padding: 10px;"> 
<h2>Checklist</h2>
<input type="text" id="newItem" placeholder="New Checklist Item">
<button onclick="createItem()">Add Item</button>
<!-- <button id="ShowEditDeleteID" onclick="ShowEditDelete()">Edit All Items</button> -->
<!-- <button id="SaveEditDeleteID" onclick="SaveEditDelete()">Save Edits</button> -->
<ul id="checklist"></ul>

  <!-- Logout -->
  <h2>Logout</h2>
  <button onclick="logout(); LoggedOutCloseChecklist();">Logout</button>

</div>
<div id="SignUpCenterButtonID" style="display: Block; text-align: center; height: 500px;">
    <br><br><br><br><br><br><br><br>
    <a><button onclick="ShowSignUp()" style="font-size: 25px;">SIGNUP & LOGIN
        </button>
    </a>
</div>



<br><br>
</div>
<!-- end of main photo -->
<footer>
    <!-- <div class="footerdivparent"> -->
    <div class="footerDiv" style="background-color: lightblue; text-align: center;">
        <br>
        <div>Peter@PatrolPeakPlanner.com</div>
        <div> &copy; 2024-2025 PatrolPeakPlanner LLC <br>
            All Rights Reserved.</div>
        <br>
    </div>
    </div>

</footer>





<!-- //////// -->

  <script>



    // function ShowEditDelete() {
        // document.getElementsByClassName("ShowEditDeleteID").style.display = "block";
    //     document.getElementById("SaveEditDeleteID").style.display = "none";
        //  }
    // function SaveEditDelete() {
    //     document.getElementById("ShowEditDeleteID").style.display = "none";
    //     document.getElementById("SaveEditDeleteID").style.display = "Block";

    // }
    //  function ShowEditDelete() {
    //         document.getElementById("ShowEditDeleteID").style.display = "block";
    //     }
        function ShowSignUp() {
            document.getElementById("SignUpID").style.display = "block";
            document.getElementById("SignUpCenterButtonID").style.display = "none";
            

        }
        function CloseSignUp() {
                document.getElementById("SignUpID").style.display = "none";

            }
        function LoggedOutCloseChecklist() {
                document.getElementById("checklistID").style.display = "none";
                 document.getElementById("SignUpCenterButtonID").style.textAlign = "center";
            document.getElementById("SignUpCenterButtonID").style.fontSize = "30px";
                document.getElementById("SignUpCenterButtonID").style.display = "block";

            }
             function LoggedInOpenChecklist() {
                    document.getElementById("checklistID").style.display = "block";
                   

                }
        



    const apiUrl = 'http://localhost:3000';
    let token = localStorage.getItem('jwtToken') || '';

    async function signUp() {
      const name = document.getElementById('signupName').value;
      const email = document.getElementById('signupEmail').value;
      const password = document.getElementById('signupPassword').value;
      const securityQuestion1 = document.getElementById('securityQuestion1').value;
      const securityAnswer1 = document.getElementById('securityAnswer1').value;
      const securityQuestion2 = document.getElementById('securityQuestion2').value;
      const securityAnswer2 = document.getElementById('securityAnswer2').value;

      const res = await fetch(`${apiUrl}/signup`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, email, password, securityQuestion1, securityAnswer1, securityQuestion2, securityAnswer2 })
      });
      alert(JSON.stringify(await res.json()));
    }

    async function login() {
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      const res = await fetch(`${apiUrl}/login`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password })
      });
      const data = await res.json();
      if (data.token) {
        alert(JSON.stringify("Login Successful"));
        token = data.token;
        localStorage.setItem('jwtToken', token);
        fetchChecklist();
      } else {
        alert(JSON.stringify(data));
      }
    }

    async function getSecurityQuestions() {
      const email = document.getElementById('forgotEmail').value;
      const res = await fetch(`${apiUrl}/forgot-password`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email })
      });
      const data = await res.json();
      if (data.securityQuestion1 && data.securityQuestion2) {
        document.getElementById('securityQuestionsSection').style.display = 'block';
        document.getElementById('securityQ1').innerText = data.securityQuestion1;
        document.getElementById('securityQ2').innerText = data.securityQuestion2;
      } else {
        alert('Email not found.');
      }
    }

    async function verifySecurityAnswers() {
      const email = document.getElementById('forgotEmail').value;
      const answer1 = document.getElementById('answer1').value;
      const answer2 = document.getElementById('answer2').value;
      const newPassword = document.getElementById('newPassword').value;

      const res = await fetch(`${apiUrl}/verify-security-answers`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, answer1, answer2, newPassword })
      });
      const data = await res.json();
      alert(data.message || data.error);
    }

    function logout() {
      token = '';
      localStorage.removeItem('jwtToken');
      document.getElementById('checklist').innerHTML = '';
    }

    // Checklist CRUD Functions
    async function fetchChecklist() {
      const res = await fetch(`${apiUrl}/items`, {
        headers: { 'Authorization': 'Bearer ' + token }
      });
      const items = await res.json();
      const list = document.getElementById('checklist');
      list.innerHTML = '';
      items.forEach(item => {
        const li = document.createElement('li');
        li.className = 'checklist-item';
        li.innerHTML = `
          <input type="checkbox" ${item.completed ? 'checked' : ''} onchange="updateItem('${item._id}', '${item.name}', this.checked, this.parentNode.querySelector('.initials-input').value)">
          <input type="text" class="initials-input" value="${item.initials || ''}" placeholder="Init" onblur="updateItem('${item._id}', '${item.name}', this.parentNode.querySelector('input[type=checkbox]').checked, this.value)">
          <button onclick="deleteItem('${item._id}')">Delete</button>
          <span>${item.name}</span> 
        `;
        list.appendChild(li);
      });
    }

    // Updated fetchChecklist to include Edit Button
        async function fetchChecklist() {
            const res = await fetch(`${apiUrl}/items`, {
                headers: { 'Authorization': 'Bearer ' + token }
            });
            const items = await res.json();
            const list = document.getElementById('checklist');
            list.innerHTML = '';
            items.forEach(item => {
                const li = document.createElement('li');
                li.className = 'checklist-item';
                li.innerHTML = `
        <input type="checkbox" ${item.completed ? 'checked' : ''} onchange="updateItem('${item._id}', '${item.name}', this.checked, this.parentNode.querySelector('.initials-input').value)">
        
        <input type="text" class="initials-input" value="${item.initials || ''}" placeholder="Init" onblur="updateItem('${item._id}', '${item.name}', this.parentNode.querySelector('input[type=checkbox]').checked, this.value)">
        <button onclick="editItemPrompt('${item._id}', '${item.name}', ${item.completed}, '${item.initials || ''}')">Edit</button>
        <button onclick="deleteItem('${item._id}')">Delete</button> <span>${item.name}</span> `;
                list.appendChild(li);
            });
        }

        // Add editItemPrompt function
        async function editItemPrompt(id, currentName, completed, initials) {
            const newName = prompt('Edit item name:', currentName);
            if (newName !== null && newName.trim() !== '') {
                await updateItem(id, newName, completed, initials);
            }
        }

          async function updateItem(id, name, completed, initials) {
                await fetch(`${apiUrl}/items/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify({ name, completed, initials })
                });
                fetchChecklist();
            }


    async function createItem() {
      const name = document.getElementById('newItem').value;
      await fetch(`${apiUrl}/items`, {
        method: 'POST',
        headers: { 
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + token
        },
        body: JSON.stringify({ name })
      });
      document.getElementById('newItem').value = '';
      fetchChecklist();
    }

  

    async function deleteItem(id) {
      await fetch(`${apiUrl}/items/${id}`, {
        method: 'DELETE',
        headers: { 'Authorization': 'Bearer ' + token }
      });
      fetchChecklist();
    }

    if (token) {
      fetchChecklist();
    }
  </script>
</body>
</html>
