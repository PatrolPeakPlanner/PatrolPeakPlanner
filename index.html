<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>User Auth & Checklist App</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; }
    input, button { margin: 5px; padding: 5px; }
    h2 { margin-top: 30px; }
    ul { list-style-type: none; padding: 0; }
    li { margin-bottom: 10px; }
    .checklist-item { display: flex; align-items: center; gap: 10px; }
    .initials-input { width: 50px; }
  </style>
</head>
<body>
<div class="mainTopnumber">
    
       

    <!-- top nav bar -->
    <div style="z-index: 10;" class="topnav">

        <div style="text-decoration: none;  background-color: darkgrey; z-index: 10;" class="topnav1">
            <a class="aTagTopNavDivLogo" style="font-size: 22px; text-decoration: none; "
                href="https://patrolpeakplanner.github.io/PatrolPeakPlanner/home.html">
                <div style="z-index: 10; color: black; margin-left:20px;margin-top: 0px;padding-top: 25px;"
                    class="mainLogo1">

                    <h3
                        style="font-family:Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif; font-size: 36px; color: white; text-shadow: 0px 0px 10px black;">
                        PATROLPEAKPLANNER </h3>
            </a>
            <a href="https://patrolpeakplanner.github.io/PatrolPeakPlanner/home.html"><button
                    style=" text-decoration: none; border-radius: 20px; font-size: 12px;">LIFEGAURD</button>
            </a>
            <a href="https://patrolpeakplanner.github.io/PatrolPeakPlanner/indexpage.html"><button
                    style=" text-decoration: none; border-radius: 20px; font-size: 12px;">SKI PATROL</button>
            </a>
            <!-- <a href="/Users/ptk726/Desktop/dev/PatrolPeakPlanner/index.html" ><button style="font-size: 12px;">LOGIN
                </button> -->
            </a>
            <a href="https://patrolpeakplanner.github.io/PatrolPeakPlanner/index.html"><button onclick="ShowSignUp()" style=" text-decoration: none; border-radius: 20px; font-size: 12px;">SIGNUP & LOGIN
                </button>
            </a>

        </div>

        <br><br>
    </div>
</div>
<!-- end of top nav -->
 <div
        style="background-image: url('https://github.com/PatrolPeakPlanner/PatrolPeakPlanner/blob/main/ImagePool.jpg?raw=true'); height: 1000px; background-repeat: no-repeat; background-size: cover; text-align: left; padding: 0 50px; font-size: 20px; font-family: arial; color: white; text-shadow: 0px 0px 3px black">
        <br>


  <!-- <h1>User Authentication & Checklist App</h1> -->
<div id="SignUpID" style="display: none; font-size: 20px;" >
  <!-- Sign Up Section -->
  <h2>Sign Up</h2>
  <input style="font-size: 20px;" type="text" id="signupName" placeholder="Name"> <br>
  <input style="font-size: 20px;" type="email" id="signupEmail" placeholder="Email"> <br>
  <input style="font-size: 20px;" type="password" id="signupPassword" placeholder="Password"><br>
  <input style="font-size: 20px;" type="text" id="securityQuestion1" placeholder="Security Question 1"> <br>
  <input style="font-size: 20px;" type="text" id="securityAnswer1" placeholder="Answer 1"><br>
  <input style="font-size: 20px;" type="text" id="securityQuestion2" placeholder="Security Question 2"> <br>
  <input style="font-size: 20px;" type="text" id="securityAnswer2" placeholder="Answer 2"><br>
  <button style="border-radius:20px; font-size: 20px;" onclick="signUp()">Sign Up</button>


  <!-- Login Section -->
  <h2>Login</h2>
  <input style="font-size: 20px;" type="email" id="loginEmail" placeholder="Email"> <br>
  <input style="font-size: 20px;" type="password" id="loginPassword" placeholder="Password"><br>
  <button style="border-radius:20px; font-size: 20px;"onclick="login(); LoggedInOpenChecklist(); CloseSignUp();">Login</button>

  <!-- Forgot Password Section -->
  <h2>Forgot Password</h2>
  <input style="font-size: 20px;" type="email" id="forgotEmail" placeholder="Email"><br>
  <button style="border-radius: 20px; font-size: 20px;" onclick="getSecurityQuestions()">Get Security Questions</button><br>
  <div id="securityQuestionsSection" style="display:none;">
    <p id="securityQ1"></p>
    <input style="font-size: 20px;" type="text" id="answer1" placeholder="Answer 1"><br>
    <p id="securityQ2"></p>
    <input style="font-size: 20px;" type="text" id="answer2" placeholder="Answer 2"><br>
    <input style="font-size: 20px;" type="password" id="newPassword" placeholder="New Password"><br>
    <button style="border-radius:20px; font-size: 20px;" onclick="verifySecurityAnswers()">Reset Password</button>
  </div>

</div>
<!-- end of sign up login section -->


<br>
  <!-- Checklist Section -->
<div id="checklistID" style="display: none; background-color: white; color: black; text-shadow:none; border-radius: 20px; padding: 10px;"> 
<h2>Checklist</h2>
<input type="text" id="newItem" placeholder="New Checklist Item">
<button onclick="createItem()">Add Item</button>
<!-- <button id="ShowEditDeleteID" onclick="ShowEditDelete()">Edit All Items</button> -->
<!-- <button id="SaveEditDeleteID" onclick="SaveEditDelete()">Save Edits</button> -->
<ul id="checklist"></ul>

  <!-- Logout -->
  <h2>Logout</h2>
  <button style="border-radius: 20px; font-size: 20px; padding: 0 20px;" onclick="logout(); LoggedOutCloseChecklist();">Logout</button><br>

</div>
<div id="SignUpCenterButtonID" style="display: Block; text-align: center; height: 500px;">
    <br><br><br><br><br><br><br><br>
    <a><button onclick="ShowSignUp()" style=" border-radius: 40px; padding: 0 30px; font-size: 40px;">SIGNUP & LOGIN
        </button>
    </a>
</div>

<!-- <div style="background-color: lightgreen ;"></div>
<div style="background-color: lightgray;"></div>
<div style="background-color: lightslategray ;"></div> -->

<br><br><br><br>
</div>
<!-- end of main photo -->


<footer>
    <!-- <div class="footerdivparent"> -->
    <div class="footerDiv" style="background-color: lightblue; text-align: center;">
        <br>
        <div>Peter@PatrolPeakPlanner.com</div>
        <div> &copy; 2024-2025 PatrolPeakPlanner LLC <br>
            All Rights Reserved.</div>
        <br>
    </div>
    </div>

</footer>





<!-- //////// -->

  <script>
    function ShowSignUp() {
        document.getElementById("SignUpID").style.display = "block";
        document.getElementById("SignUpCenterButtonID").style.display = "none";


    }
    function CloseSignUp() {
        document.getElementById("SignUpID").style.display = "none";

    }
    function LoggedOutCloseChecklist() {
        document.getElementById("checklistID").style.display = "none";
        document.getElementById("SignUpCenterButtonID").style.textAlign = "center";
        document.getElementById("SignUpCenterButtonID").style.fontSize = "30px";
        document.getElementById("SignUpCenterButtonID").style.display = "block";

    }
    function LoggedInOpenChecklist() {
        document.getElementById("checklistID").style.display = "block";


    }



    const apiUrl = 'http://localhost:3000';

    async function signUp() {
        const name = document.getElementById('signupName').value;
        const email = document.getElementById('signupEmail').value;
        const password = document.getElementById('signupPassword').value;
        const securityQuestion1 = document.getElementById('securityQuestion1').value;
        const securityAnswer1 = document.getElementById('securityAnswer1').value;
        const securityQuestion2 = document.getElementById('securityQuestion2').value;
        const securityAnswer2 = document.getElementById('securityAnswer2').value;

        const res = await fetch(`${apiUrl}/signup`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, email, password, securityQuestion1, securityAnswer1, securityQuestion2, securityAnswer2 })
        });
        alert(JSON.stringify(await res.json()));
    }

    async function login() {
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        const res = await fetch(`${apiUrl}/login`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password }),
            credentials: 'include'
        });
        const data = await res.json();
        alert(data.message || data.error);
        if (res.ok) {
            fetchChecklist();
        }
    }

    async function logout() {
        await fetch(`${apiUrl}/logout`, {
            method: 'POST',
            credentials: 'include'
        });
        alert('Logged out');
        document.getElementById('checklist').innerHTML = '';
    }

    async function getSecurityQuestions() {
        const email = document.getElementById('forgotEmail').value;
        const res = await fetch(`${apiUrl}/forgot-password`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email })
        });
        const data = await res.json();
        if (data.securityQuestion1 && data.securityQuestion2) {
            document.getElementById('securityQuestionsSection').style.display = 'block';
            document.getElementById('securityQ1').innerText = data.securityQuestion1;
            document.getElementById('securityQ2').innerText = data.securityQuestion2;
        } else {
            alert('Email not found.');
        }
    }

    async function verifySecurityAnswers() {
        const email = document.getElementById('forgotEmail').value;
        const answer1 = document.getElementById('answer1').value;
        const answer2 = document.getElementById('answer2').value;
        const newPassword = document.getElementById('newPassword').value;

        const res = await fetch(`${apiUrl}/verify-security-answers`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, answer1, answer2, newPassword })
        });
        const data = await res.json();
        alert(data.message || data.error);
    }

    async function fetchChecklist() {
        const res = await fetch(`${apiUrl}/items`, {
            credentials: 'include'
        });
        const items = await res.json();
        const list = document.getElementById('checklist');
        list.innerHTML = '';
        items.forEach(item => {
            const li = document.createElement('li');
            li.className = 'checklist-item';

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.checked = item.completed;
            checkbox.addEventListener('change', () => {
                updateItem(item._id, item.name, checkbox.checked, initialsInput.value);
            });

            const initialsInput = document.createElement('input');
            initialsInput.type = 'text';
            initialsInput.className = 'initials-input';
            initialsInput.value = item.initials || '';
            initialsInput.placeholder = 'Init';
            initialsInput.addEventListener('blur', () => {
                updateItem(item._id, item.name, checkbox.checked, initialsInput.value);
            });

            const editButton = document.createElement('button');
            editButton.innerText = 'Edit';
            editButton.addEventListener('click', () => {
                editItemPrompt(item._id, item.name, item.completed, item.initials || '');
            });

            const deleteButton = document.createElement('button');
            deleteButton.innerText = 'Delete';
            deleteButton.addEventListener('click', () => {
                deleteItem(item._id);
            });

            const nameSpan = document.createElement('span');
            nameSpan.innerText = item.name;

            li.appendChild(checkbox);
            li.appendChild(initialsInput);
            li.appendChild(editButton);
            li.appendChild(deleteButton);
            li.appendChild(nameSpan);

            list.appendChild(li);
        });
    }

    async function createItem() {
        const name = document.getElementById('newItem').value;
        await fetch(`${apiUrl}/items`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name }),
            credentials: 'include'
        });
        document.getElementById('newItem').value = '';
        fetchChecklist();
    }

    async function updateItem(id, name, completed, initials) {
        await fetch(`${apiUrl}/items/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, completed, initials }),
            credentials: 'include'
        });
        fetchChecklist();
    }

    async function deleteItem(id) {
        await fetch(`${apiUrl}/items/${id}`, {
            method: 'DELETE',
            credentials: 'include'
        });
        fetchChecklist();
    }

    async function editItemPrompt(id, currentName, completed, initials) {
        const newName = prompt('Edit item name:', currentName);
        if (newName !== null && newName.trim() !== '') {
            await updateItem(id, newName, completed, initials);
        }
    }

    // Auto-fetch checklist on load
    fetchChecklist();
</script>
</body>
</html>
